<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  <script src="js/bugzilla.js"></script>
</head>
<body>
</body>
<script>

const BAR_COLOERS = [
    "#b91d47",
    "#00aba9",
    "#2b5797",
    "#e8c3b9",
    "#1e7145",
    "#7b3627",
    "#27767b",
    "#337b27",
    "#d347df",
    "#4756df",
  ];

function GetCanvasForVersion(version) {
  let div = document.createElement("div");
  let canvas = document.createElement('canvas');
  canvas.id = `chart_${version}`;
  canvas.style = "width:100%;max-width:600px";
  let title = document.createElement('h2');
  title.innerHTML = `Firefox ${version} Fixed Bugs Overview`;
  let link = document.createElement("a");
  link.innerHTML = "buglist";
  link.href = GetBugListLinkForVersion(version);
  div.appendChild(title);
  div.appendChild(link);
  div.appendChild(canvas);
  document.body.appendChild(div);
  return canvas;
}

async function GetPieChartForFixedBugsFromVersion(version) {
  let buglist = await GenerateFixedBugListForVersion(version);
  let data = GetCategoriesDistributionFromBugList(buglist);

  // convert map to arrays
  let categories = Array.from(data.keys());
  let bugAmounts = Array.from(data.values());

  new Chart(GetCanvasForVersion(version), {
    type: "pie",
    data: {
      labels: categories,
      datasets: [{
        backgroundColor: BAR_COLOERS,
        data: bugAmounts
      }]
    },
    options: {
      title: {
        text: `Firefox ${version} Fixed Bugs Overview`
      }
    }
  });
}

(async _ => {
  const latestVersion = 110;
  const displayVersionAmount = 5;
  for (let ver = latestVersion; ver > latestVersion - displayVersionAmount; ver--) {
    GetPieChartForFixedBugsFromVersion(ver);
  }
})();

</script>
</html>